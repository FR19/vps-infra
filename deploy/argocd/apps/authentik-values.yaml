# Values for Authentik Helm chart (mirrors Application helm.values).
# Test locally: ./scripts/helm-template-authentik.sh

# Override image tags; chart defaults use old Bitnami tags no longer on Docker Hub
postgresql:
  enabled: true
  auth:
    # One-time: create the Secret with ./infra/scripts/create-auth-db-secret.sh
    existingSecret: authentik-postgresql
    secretKeys:
      userPasswordKey: password
      adminPasswordKey: postgres-password
  image:
    tag: "latest"
redis:
  enabled: true
  image:
    tag: "latest"

# Override chart default so deprecation check does not fire (we use server.ingress only)
ingress: null

# Secret key: create with ./infra/scripts/create-auth-secret.sh
server:
  env:
    - name: AUTHENTIK_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: authentik-secret-key
          key: secret_key
    - name: AUTHENTIK_POSTGRESQL__PASSWORD
      valueFrom:
        secretKeyRef:
          name: authentik-postgresql
          key: password
  ingress:
    enabled: true
    ingressClassName: traefik
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - auth.tukangketik.net
    pathType: Prefix
    tls:
      - secretName: authentik-tls
        hosts:
          - auth.tukangketik.net
worker:
  env:
    - name: AUTHENTIK_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: authentik-secret-key
          key: secret_key
    - name: AUTHENTIK_POSTGRESQL__PASSWORD
      valueFrom:
        secretKeyRef:
          name: authentik-postgresql
          key: password
