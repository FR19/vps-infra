# SOGo main config. IMAP/SMTP point to Stalwart; auth via Authentik LDAP.
# Create secret: kubectl create secret generic sogo-ldap-bind -n sogo --from-literal=bindpw='<ldap-service-account-password>'
apiVersion: v1
kind: ConfigMap
metadata:
  name: sogo-config
  namespace: sogo
  labels:
    app.kubernetes.io/name: sogo
data:
  sogo.conf: |
    SOGoProfileURL = "ldap://ak-outpost-ldap.auth.svc.cluster.local:389/dc=ldap,dc=goauthentik,dc=io?cn?sub?(objectClass=user)";
    SOGoUserSources = (
      {
        type = ldap;
        id = directory;
        displayName = "Authentik";
        hostname = "ak-outpost-ldap.auth.svc.cluster.local";
        port = 389;
        baseDN = "ou=users,dc=ldap,dc=goauthentik,dc=io";
        bindDN = "cn=ldapservice,ou=users,dc=ldap,dc=goauthentik,dc=io";
        bindPasswordFile = "/run/secrets/ldap-bind-password";
        filter = "objectClass=user";
        CN = "cn";
        UID = "cn";
        mail = "mail";
        searchField = "cn";
      }
    );
    SOGoIMAPServer = "stalwart-mail.mail.svc.cluster.local";
    SOGoSMTPServer = "stalwart-mail.mail.svc.cluster.local";
    SOGoMailingMechanism = smtp;
    SOGoAuthenticationType = LDAP;
    SOGoPageTitle = "Mail";
    SOGoUIAdditionalLanguages = ( "en" );
