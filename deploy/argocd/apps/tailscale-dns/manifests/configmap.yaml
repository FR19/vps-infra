# CoreDNS config: serve tukangketik.net from hosts file, forward everything else.
# Add more records to tukangketik.hosts as needed (argocd, headscale, headplane, auth, mail, etc.).
apiVersion: v1
kind: ConfigMap
metadata:
  name: tailscale-dns-config
  namespace: tailscale-dns
  labels:
    app.kubernetes.io/name: tailscale-dns
data:
  Corefile: |
    .:53 {
        forward . tls://94.140.14.14 tls://94.140.15.15 {
            tls_servername dns.adguard-dns.com
            health_check 5s
        }

        forward . tls://76.76.2.11 {
            tls_servername p2.freedns.controld.com
            health_check 5s
        }

        cache
        log
    }
    tukangketik.net:53 {
        hosts /etc/coredns/tukangketik.hosts tukangketik.net {
            fallthrough
        }
        
        forward . tls://94.140.14.14 tls://94.140.15.15 {
            tls_servername dns.adguard-dns.com
            health_check 5s
        }

        forward . tls://76.76.2.11 {
            tls_servername p2.freedns.controld.com
            health_check 5s
        }
        cache
        log
    }
  tukangketik.hosts: |
    # Tailnet IP for VPN-only services (Argo CD).
    # If you deploy the in-cluster Argo CD VPN proxy (`argocd-vpn-proxy` app),
    # update this record to the proxy pod's Tailnet IP (not the VPS Tailnet IP).
    100.64.0.2 argocd.tukangketik.net
    # VPS public IP for public services (update if your VPS IP differs)
    135.125.131.209 headscale.tukangketik.net headplane.tukangketik.net auth.tukangketik.net
    # Add more as needed: mail.tukangketik.net, device.vpn.tukangketik.net, etc.
