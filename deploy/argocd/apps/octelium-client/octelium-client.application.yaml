apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: octelium-client
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "2"
spec:
  project: vps-platform
  source:
    # Git repo avoids GHCR rate limits (no OCI credential needed). Alternative: oci://ghcr.io/octelium/helm-charts + targetRevision tag.
    repoURL: https://github.com/octelium/helm-charts.git
    path: charts/octelium
    targetRevision: master # or a commit SHA / tag from https://github.com/octelium/helm-charts
    helm:
      releaseName: octelium-client
      values: |
        # Override in Application or via values.yaml; see docs/octelium.md
        revisionHistoryLimit: 2
        octelium:
          domain: "octelium.tukangketik.net"  # set to your Octelium cluster domain
          authTokenSecret: "octelium-auth-token"  # Secret in namespace octelium with auth token
          # serve: []  # optional: list of services to expose over VPN, e.g. ["argocd-server.argocd.svc.cluster.local"]
  destination:
    server: https://kubernetes.default.svc
    namespace: octelium
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
