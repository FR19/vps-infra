# Firezone - self-hosted at firezone.tukangketik.net
# Chart from https://github.com/Intuinewin/helm-charts (firezone)
# Requires: firezone-postgresql, firezone-secrets (run create-firezone-secrets.sh)

nameOverride: ""
fullnameOverride: ""
clusterDomain: cluster.local

global:
  dockerRegistry: ghcr.io/firezone
  runManualMigrations: true
  otlp:
    endpoint: ""
  logLevel: info
  externalWebURL: https://firezone.tukangketik.net
  externalApiURL: https://api.firezone.tukangketik.net
  externalApiWSURL: wss://api.firezone.tukangketik.net

  database:
    host: firezone-postgresql
    port: 5432
    database: firezone
    ssl: false
    pool_size: 10
    username:
      secret: firezone-postgresql
      key: username
    password:
      secret: firezone-postgresql
      key: postgres-password

  erlangCluster:
    epmdPort: 4369
    distributionPort: 9000
    enableKubernetesClusterModule: true
    kubernetes:
      selector:
        key: erlangcluster
        value: firezone
    cookie:
      secret: firezone-secrets
      key: RELEASE_COOKIE

  phoenix:
    keyBase:
      secret: firezone-secrets
      key: SECRET_KEY_BASE
    liveViewSalt:
      secret: firezone-secrets
      key: LIVE_VIEW_SIGNING_SALT
    cookieSigningSalt:
      secret: firezone-secrets
      key: COOKIE_SIGNING_SALT
    cookieEncryptionSalt:
      secret: firezone-secrets
      key: COOKIE_ENCRYPTION_SALT

  tokens:
    keyBase:
      secret: firezone-secrets
      key: TOKENS_KEY_BASE
    salt:
      secret: firezone-secrets
      key: TOKENS_SALT

  email:
    adapter: Elixir.Swoosh.Adapters.SMTP
    from: firezone@tukangketik.net
    opts:
      secret: firezone-secrets
      key: OUTBOUND_EMAIL_ADAPTER_OPTS

  signup:
    enabled: true
    whitelistedDomains: []

  features:
    idpSync:
      enabled: true
    multiSiteResources:
      enabled: true
    policyConditions:
      enabled: true
    restApi:
      enabled: true
    internetResource:
      enabled: true

web:
  replicaCount: 1
  revisionHistoryLimit: 10
  image:
    repository: ghcr.io/firezone/portal
    pullPolicy: IfNotPresent
    tag: ""
  releaseName: firezone
  backgroundJobsEnabled: false
  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
    portName: http
  healthPort: 9001
  livenessProbe:
    initialDelaySeconds: 0
    periodSeconds: 10
    timeoutSeconds: 1
    failureThreshold: 3
    successThreshold: 1
  readinessProbe:
    initialDelaySeconds: 0
    periodSeconds: 10
    timeoutSeconds: 1
    failureThreshold: 3
    successThreshold: 1
  serviceAccount:
    create: true
    automount: true
  autoscaling:
    enabled: false
  pdb:
    enabled: false
  ingress:
    enabled: true
    className: traefik
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - host: firezone.tukangketik.net
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: firezone-web-tls
        hosts:
          - firezone.tukangketik.net

api:
  replicaCount: 1
  revisionHistoryLimit: 10
  image:
    repository: ghcr.io/firezone/portal
    pullPolicy: IfNotPresent
    tag: ""
  releaseName: firezone
  backgroundJobsEnabled: false
  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
    portName: http
  healthPort: 9001
  livenessProbe:
    initialDelaySeconds: 0
    periodSeconds: 10
    timeoutSeconds: 1
    failureThreshold: 3
    successThreshold: 1
  readinessProbe:
    initialDelaySeconds: 0
    periodSeconds: 10
    timeoutSeconds: 1
    failureThreshold: 3
    successThreshold: 1
  serviceAccount:
    create: true
    automount: true
  autoscaling:
    enabled: false
  pdb:
    enabled: false
  ingress:
    enabled: true
    className: traefik
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - host: api.firezone.tukangketik.net
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: firezone-api-tls
        hosts:
          - api.firezone.tukangketik.net

domain:
  replicaCount: 1
  revisionHistoryLimit: 10
  image:
    repository: ghcr.io/firezone/portal
    pullPolicy: IfNotPresent
    tag: ""
  releaseName: firezone
  backgroundJobsEnabled: true
  healthPort: 9001
  livenessProbe:
    initialDelaySeconds: 0
    periodSeconds: 10
    timeoutSeconds: 1
    failureThreshold: 3
    successThreshold: 1
  readinessProbe:
    initialDelaySeconds: 0
    periodSeconds: 10
    timeoutSeconds: 1
    failureThreshold: 3
    successThreshold: 1
  serviceAccount:
    create: true
    automount: true
  autoscaling:
    enabled: false
  pdb:
    enabled: false
