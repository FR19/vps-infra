{{- if and .Values.argo-cd.server.ingress.enabled (eq .Values.argo-cd.server.ingress.controller "generic") }}
# Redirect all HTTP (port 80) to HTTPS for any host. More specific routes (e.g. ACME
# /.well-known/acme-challenge/) take precedence. Uses a placeholder service; the
# redirect middleware responds before the request reaches the backend.
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: http-to-https-redirect
  namespace: {{ .Release.Namespace | quote }}
  labels:
    app.kubernetes.io/name: argocd-wrapper
    app.kubernetes.io/component: redirect
spec:
  entryPoints:
    - web
  routes:
    - match: HostRegexp(`{host:.+}`)
      kind: Rule
      priority: 1
      middlewares:
        - name: redirect-https
          namespace: {{ .Release.Namespace | quote }}
      services:
        - name: argocd-server
          port: 80
{{- end }}
